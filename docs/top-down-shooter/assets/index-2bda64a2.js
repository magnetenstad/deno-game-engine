var S=Object.defineProperty;var O=(n,t,e)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(O(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const L=(n,t)=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)};class _{constructor(t,e){r(this,"x");r(this,"y");this.x=t,this.y=e}add(t){return new _(this.x+t.x,this.y+t.y)}multiply(t){return new _(this.x*t,this.y*t)}divide(t){return new _(this.x/t,this.y/t)}half(){return this.multiply(.5)}snap(t){return new _(Math.round(this.x/t)*t,Math.round(this.y/t)*t)}lengthTo(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}isInside(t,e){return t.x<=this.x&&this.x<=t.x+e.x&&t.y<=this.y&&this.y<=t.y+e.y}moveTowards(t,e){return this.add(this.direction(t).multiply(e))}direction(t){if(t.y===this.y&&t.x===this.x)return new _(0,0);const e=Math.atan2(t.y-this.y,t.x-this.x);return new _(Math.cos(e),Math.sin(e))}round(){return new _(Math.round(this.x),Math.round(this.y))}copy(){return new _(this.x,this.y)}}var f;(function(n){n[n.Left=0]="Left",n[n.Middle=1]="Middle",n[n.Right=2]="Right",n[n.BrowserBack=3]="BrowserBack",n[n.BrowserForward=4]="BrowserForward"})(f||(f={}));const p=new Set,g=new Set,m=new Set;document.addEventListener("keydown",n=>{p.add(n.key)});document.addEventListener("keyup",n=>{g.add(n.key)});const b=n=>{const t=n.__canvas.__canvasElement,e=new Set,s=new Set,i=new Set,a=h=>{e.forEach(c=>{i.add(c.button),h.forEach(d=>{d.onMousePress&&d.onMousePress(c)})}),e.clear(),s.forEach(c=>{i.delete(c.button),h.forEach(d=>{d.onMouseRelease&&d.onMouseRelease(c)})}),s.clear(),p.forEach(c=>{m.add(c),h.forEach(d=>{d.onKeyPress&&d.onKeyPress(c)})}),p.clear(),g.forEach(c=>{m.delete(c),h.forEach(d=>{d.onKeyRelease&&d.onKeyRelease(c)})}),g.clear()},o={mouse:{pos:new _(0,0),button:h=>i.has(h)},key:h=>m.has(h),__handleInput:a},u=h=>{const c=n.__options.scale??1;return new _((h.pageX-t.offsetLeft)/c,(h.pageY-t.offsetTop)/c)};document.addEventListener("mousedown",h=>{e.add({button:h.button,pos:u(h)})}),document.addEventListener("mouseup",h=>{s.add({button:h.button,pos:u(h)})});const w=h=>h.preventDefault();return document.addEventListener("mousemove",h=>{const c=u(h);o.mouse.pos.x=c.x,o.mouse.pos.y=c.y;const d=n.__options.scale??1;o.mouse.pos.isInside(new _(0,0),new _(t.width/d,t.height/d))?document.addEventListener("contextmenu",w):document.removeEventListener("contextmenu",w)}),o};class M{constructor(t){r(this,"__parent");r(this,"__canvasElement");r(this,"__ctx");r(this,"withStyle",(t,e)=>{this.__ctx.save(),t.strokeStyle&&(this.__ctx.strokeStyle=t.strokeStyle),t.lineWidth!==void 0&&(this.__ctx.lineWidth=t.lineWidth),t.fillStyle&&(this.__ctx.fillStyle=t.fillStyle),(t.font||t.fontSize)&&(this.__ctx.font=`${t.fontSize??8}px ${t.font??"arial"}`),e(),this.__ctx.restore()});r(this,"drawImage",(t,e,s={smoothing:!1})=>{t.__image&&(this.__ctx.imageSmoothingEnabled=s.smoothing,this.__ctx.drawImage(t.__image,e.x,e.y,t.__image.width,t.__image.height))});this.__parent=t,this.__canvasElement=document.createElement("canvas"),this.__canvasElement.classList.add("gameCanvas"),this.__parent.appendChild(this.__canvasElement),this.__ctx=this.__canvasElement.getContext("2d"),this.__ctx||console.error("Could not get context of canvas!")}drawRect(t,e,s={fillStyle:"white"}){this.withStyle(s,()=>{this.__ctx.fillRect(t.x,t.y,e.x,e.y)})}drawClear(){this.__ctx.clearRect(0,0,this.__canvasElement.width,this.__canvasElement.height)}drawPath(t,e={strokeStyle:"white",lineWidth:1}){this.withStyle(e,()=>{this.__ctx.beginPath(),this.__ctx.moveTo(t[0].x,t[0].y);for(let s=0;s<t.length;s++)this.__ctx.lineTo(t[s].x,t[s].y);this.__ctx.stroke()})}drawLine(t,e,s){const i=t.copy(),a=e.copy(),o=Math.atan2(a.y-i.y,a.x-i.x);s.startOffset&&(i.x+=s.startOffset*Math.cos(o),i.y+=s.startOffset*Math.sin(o)),s.endOffset&&(a.x+=s.endOffset*Math.cos(o),a.y+=s.endOffset*Math.sin(o));const u=i.lengthTo(a);s.maxLength&&u>s.maxLength?(a.x=i.x+s.maxLength*Math.cos(o),a.y=i.y+s.maxLength*Math.sin(o)):s.minLength&&u<s.minLength&&(a.x=i.x+s.minLength*Math.cos(o),a.y=i.y+s.minLength*Math.sin(o)),this.drawPath([i,a])}drawText(t,e,s={fillStyle:"white",font:"arial",fontSize:8}){this.withStyle(s,()=>{this.__ctx.fillText(t,e.x,e.y+(s.fontSize??0))})}drawCircle(t,e,s={fillStyle:"white"}){this.withStyle(s,()=>{this.__ctx.beginPath(),this.__ctx.arc(e.x,e.y,t,0,2*Math.PI),this.__ctx.fill(),this.__ctx.stroke()})}}const v={width:480,height:320,scale:2,fps:60,zSort:!0,baseUrl:"./"};class I{constructor(t){r(this,"__gameDiv");r(this,"__assetsDiv");r(this,"__options",v);r(this,"__gameObjects",[]);r(this,"__canvas");r(this,"__t",0);r(this,"__input");r(this,"currentFps",0);if(!t)throw new Error("Element passed to Game() is null!");if(!(t instanceof HTMLDivElement))throw new Error("Element passed to Game() is not an HTMLDivElement!");this.__gameDiv=t,this.__canvas=new M(this.__gameDiv),this.__assetsDiv=document.createElement("div"),this.__assetsDiv.hidden=!0,this.__gameDiv.appendChild(this.__assetsDiv),this.setOptions(v),this.__input=b(this)}setOptions(t){this.__options={...this.__options,...t};const e=this.getCanvasSize().multiply(this.__options.scale);return this.__canvas.__canvasElement.width=e.x,this.__canvas.__canvasElement.height=e.y,this.__canvas.__ctx.scale(this.__options.scale,this.__options.scale),this}getCanvasSize(){return new _(this.__options.width,this.__options.height)}__addObject(t){this.__gameObjects.push(t)}__removeObject(t){L(this.__gameObjects,t)}play(){let t=0,e=0;const s=i=>{requestAnimationFrame(s);const a=i-t,o=1e3/this.__options.fps;a>=o&&(t=i-a%o,this.currentFps=1e3/(i-e),e=i,this.__step())};s(0)}__maybeSort(){if(!this.__options.zSort)return;let t=!1;for(let e=0;e<this.__gameObjects.length;e++)if(this.__gameObjects[e].__changed){t=!0;break}t&&(this.__gameObjects.sort((e,s)=>e.__zIndex-s.__zIndex),this.__gameObjects.forEach(e=>e.__changed=!1))}__step(){this.__maybeSort(),this.__input.__handleInput(this.__gameObjects),this.__canvas.drawClear(),this.__gameObjects.forEach(t=>{t.draw&&t.draw({game:this,canvas:this.__canvas,input:this.__input,t:this.__t})}),this.__gameObjects.forEach(t=>{t.step&&t.step({game:this,input:this.__input,dtFactor:Math.round(this.__options.fps/this.currentFps)})}),this.__t++}}const E=new Map;class P{}class T extends P{constructor(e,s){super();r(this,"__path");r(this,"__image");this.__path=e,s&&this.__load(s)}__load(e){var a;const s=E.get(this.__path);s instanceof HTMLImageElement&&(this.__image=s);const i=new Image;i.src=this.__path,i.onload=()=>{E.set(this.__path,i),this.__image=i},(a=e.__assetsDiv)==null||a.appendChild(i)}size(){var e,s;return new _(((e=this.__image)==null?void 0:e.width)??0,((s=this.__image)==null?void 0:s.height)??0)}}class C{constructor(){r(this,"__changed",!0);r(this,"__zIndex",0);r(this,"__game");this.activate()}activate(t){var e;return t&&(this.deactivate(),this.__game=t),(e=this.__game)==null||e.__addObject(this),this}deactivate(){var t;(t=this.__game)==null||t.__removeObject(this)}destruct(){this.deactivate(),this.destructor&&this.destructor()}setZIndex(t){this.__zIndex=t,this.__changed=!0}}class x extends C{constructor(e,s){super();r(this,"pos");this.pos=new _(e,s),this.setZIndex(s)}}class k extends x{constructor(e,s,i){super(e,s);r(this,"image");this.image=new T(i)}activate(e){return super.activate(e),this.__game&&this.image.__load(this.__game),this}imageCenter(){return this.pos.add(this.image.size().half())}}class z extends x{constructor(e,s){super(e.x,e.y);r(this,"direction");r(this,"speed",10);this.direction=e.direction(s),setTimeout(()=>this.destruct(),2e3)}draw(e){e.canvas.drawCircle(3,this.pos)}step(e){this.pos=this.pos.add(this.direction.multiply(this.speed*e.dtFactor));const s=e.game.getCanvasSize();(this.pos.x<0||s.x<this.pos.x)&&(this.direction.x*=-1),(this.pos.y<0||s.y<this.pos.y)&&(this.direction.y*=-1)}}class F extends k{constructor(t,e){super(t,e,"./player.png")}draw(t){t.canvas.drawLine(this.imageCenter(),t.input.mouse.pos,{startOffset:20,maxLength:20,minLength:20}),t.canvas.drawImage(this.image,this.pos)}step(t){const e=this.pos.copy();t.input.key("w")&&(e.y-=1),t.input.key("a")&&(e.x-=1),t.input.key("s")&&(e.y+=1),t.input.key("d")&&(e.x+=1),this.pos=this.pos.moveTowards(e,1.5*t.dtFactor),this.setZIndex(this.pos.y+this.image.size().y),t.input.mouse.button(f.Left)&&new z(this.imageCenter().moveTowards(t.input.mouse.pos,16),t.input.mouse.pos).activate(t.game)}}class y extends x{constructor(e,s,i){super(s,i);r(this,"getText");this.getText=e}draw(e){e.canvas.drawText(this.getText(),this.pos)}}const D=document.querySelector("#game"),l=new I(D).setOptions({width:480,height:320,scale:2,fps:60}),R=new F(100,250).activate(l);new y(()=>`Player: ${JSON.stringify(R.pos)}`,0,0).activate(l);new y(()=>`Objects: ${l.__gameObjects.length}`,0,16).activate(l);new y(()=>`FPSd: ${l.currentFps.toFixed(1)}`,0,32).activate(l);l.play();
